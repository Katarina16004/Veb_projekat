@model Veb_Projekat.Models.Reservation
@{
    ViewBag.Title = "Reservation Details";
    bool isPast = Model.SelectedArrangement.StartDate <= DateTime.Now;
    bool canCancel = Model.Status == Veb_Projekat.Models.Enums.ReservationStatusEnum.Active && !isPast;
    bool canComment = Model.Status == Veb_Projekat.Models.Enums.ReservationStatusEnum.Active && Model.SelectedArrangement.EndDate < DateTime.Now;
}

<h2 style="margin:20px">Reservation Details</h2>

<div style="background:#f8f9fa; padding:20px; border:1px solid #dee2e6; margin-bottom:20px;">
    <div style="display:flex; justify-content:space-between;">
        <h3>Reservation #@Model.Id.ToString()</h3>
        <span style="padding:5px 5px; border-radius:5px; color:white; background:@(Model.Status == Veb_Projekat.Models.Enums.ReservationStatusEnum.Active ? "#28a745" : "#dc3545");">
            @Model.Status
        </span>
    </div>
</div>

<div style="border:1px solid #dee2e6; padding:15px; margin-bottom:20px;">
    <h4 style="color:#007bff; margin-bottom:15px;">Arrangement Information</h4>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <div><strong>Name:</strong> @Model.SelectedArrangement.Name</div>
        <div><strong>Location:</strong> @Model.SelectedArrangement.Location</div>
        <div><strong>Type:</strong> @Model.SelectedArrangement.Type</div>
        <div><strong>Transport:</strong> @Model.SelectedArrangement.Transport</div>
        <div><strong>Start Date:</strong> @Model.SelectedArrangement.StartDate.ToString("dd/MM/yyyy")</div>
        <div><strong>End Date:</strong> @Model.SelectedArrangement.EndDate.ToString("dd/MM/yyyy")</div>
        <div><strong>Max Passengers:</strong> @Model.SelectedArrangement.MaxNumOfPassengers</div>
        <div><strong>Duration:</strong> @((Model.SelectedArrangement.EndDate - Model.SelectedArrangement.StartDate).Days) days</div>
    </div>

    @if (!string.IsNullOrEmpty(Model.SelectedArrangement.Description))
    {
        <div style="margin-top:15px;">
            <strong>Description:</strong>
            <p style="margin-top:5px;">@Model.SelectedArrangement.Description</p>
        </div>
    }

    @if (!string.IsNullOrEmpty(Model.SelectedArrangement.TravelProgram))
    {
        <div style="margin-top:15px;">
            <strong>Travel Program:</strong>
            <p style="margin-top:5px;">@Model.SelectedArrangement.TravelProgram</p>
        </div>
    }
</div>

<div style="border:1px solid #dee2e6; padding:15px; margin-bottom:20px;">
    <h4 style="color:#28a745; margin-bottom:15px;"> Your Accommodation Unit</h4>
    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
        <div><strong>Unit ID:</strong> @Model.SelectedUnit.Id</div>
        <div><strong>Max Guests:</strong> @Model.SelectedUnit.MaxGuests</div>
        <div><strong>Pets Allowed:</strong> @(Model.SelectedUnit.PetsAllowed ? "Yes" : "No")</div>
        <div><strong>Price:</strong> @Model.SelectedUnit.Price.ToString("C")</div>
    </div>

    @{
        var accommodation = Model.SelectedArrangement.Accommodations.FirstOrDefault(a => a.Units.Any(u => u.Id == Model.SelectedUnit.Id));
    }

    @if (accommodation != null)
    {
        <h5 style="margin-top:15px; color:#6c757d;">Accommodation: @accommodation.Name</h5>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
            <div><strong>Type:</strong> @accommodation.Type</div>
            <div><strong>Stars:</strong> @accommodation.Stars</div>
            <div><strong>Pool:</strong> @(accommodation.HasPool ? "Yes" : "No")</div>
            <div><strong>Spa:</strong> @(accommodation.HasSpa ? "Yes" : "No")</div>
            <div><strong>Accessible:</strong> @(accommodation.Accessible ? "Yes" : "No")</div>
            <div><strong>WiFi:</strong> @(accommodation.HasWifi ? "Yes" : "No")</div>
        </div>
    }
</div>

<div style="border:1px solid #dee2e6; padding:15px; margin-bottom:20px;">
    <h4 style="color:#6f42c1; margin-bottom:15px;">Status Information</h4>

    @if (isPast)
    {
        <div style="background:#fff3cd; color:#856404; padding:10px; border-radius:5px; margin-bottom:10px;">
            <strong>Past Trip:</strong> This arrangement has already started or finished.
        </div>
    }
    else
    {
        <div style="background:#d4edda; color:#155724; padding:10px; border-radius:5px; margin-bottom:10px;">
            <strong>Upcoming Trip:</strong> This arrangement starts in @((Model.SelectedArrangement.StartDate - DateTime.Now).Days) days.
        </div>
    }

    @if (Model.Status == Veb_Projekat.Models.Enums.ReservationStatusEnum.Cancelled)
    {
        <div style="background:#f8d7da; color:#721c24; padding:10px; border-radius:5px;">
            <strong>Cancelled:</strong> This reservation has been cancelled.
        </div>
    }
</div>



<div style="margin:20px;">
    @Html.ActionLink("← Back to My Reservations", "MyReservations", "Tourist", null, new { @style = "background:#6c757d; color:white; padding:8px 15px; text-decoration:none; border-radius:3px; margin-right:10px; margin-left:20px" })

    @if (canCancel)
    {
        using (Html.BeginForm("CancelReservation", "Tourist", FormMethod.Post, new { @class = "button-form", @style = "display:inline;" }))
        {
            <input type="hidden" name="reservationId" value="@Model.Id" />
            <button type="submit" onclick="return confirm('Are you sure you want to cancel this reservation? This action cannot be undone.');"
                    style="background:#dc3545; color:white; border:none; padding:8px 15px; cursor:pointer; border-radius:3px; margin-right:10px;">
                Cancel Reservation
            </button>
        }
    }

    @if (canComment)
    {
        @Html.ActionLink("Leave Comment", "LeaveComment", new { accommodationId = accommodation?.Id ?? 0, reservationId = Model.Id.ToString() },
                       new { @style = "background:#17a2b8; color:white; padding:8px 15px; text-decoration:none; border-radius:3px;" })
    }
</div>