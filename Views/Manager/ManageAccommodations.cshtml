@using Veb_Projekat.Models
@{
    ViewBag.Title = "Manage Accommodations";
    var arrangement = ViewBag.Arrangement as Arrangement;
    var accommodations = ViewBag.Accommodations as List<Accommodation>;
}

<h2>Manage Accommodations for: @arrangement.Name</h2>

<p><strong>Arrangement Details:</strong></p>
<ul>
    <li>Location: @arrangement.Location</li>
    <li>Dates: @arrangement.StartDate.ToString("dd/MM/yyyy") - @arrangement.EndDate.ToString("dd/MM/yyyy")</li>
    <li>Type: @arrangement.Type</li>
</ul>

@if (TempData["Success"] != null)
{
    <p style="color: green;"><strong>Success:</strong> @TempData["Success"]</p>
}

@if (TempData["Error"] != null)
{
    <p style="color: red;"><strong>Error:</strong> @TempData["Error"]</p>
}

<h3>Actions</h3>
<p>
    @Html.ActionLink("Add New Accommodation", "CreateAccommodation", new { arrangementId = arrangement.Id }, new { @class = "btn" }) |
    @Html.ActionLink("Back to Dashboard", "Index")
</p>

<h3>Accommodations (@(accommodations?.Count ?? 0))</h3>

@if (accommodations != null && accommodations.Any())
{
    <table border="1" style="width: 100%; border-collapse: collapse;">
        <tr style="background-color: #f0f0f0;">
            <th style="padding: 10px;">Name</th>
            <th style="padding: 10px;">Type</th>
            <th style="padding: 10px;">Stars</th>
            <th style="padding: 10px;">Features</th>
            <th style="padding: 10px;">Units</th>
            <th style="padding: 10px;">Status</th>
            <th style="padding: 10px;">Actions</th>
        </tr>

        @foreach (var accommodation in accommodations)
        {
            <tr>
                <td style="padding: 10px;">
                    <strong>@accommodation.Name</strong><br />
                    <small>ID: @accommodation.Id</small>
                </td>
                <td style="padding: 10px;">@accommodation.Type</td>
                <td style="padding: 10px;">
                    @if (accommodation.Type == Veb_Projekat.Models.Enums.AccommodationTypeEnum.Hotel)
                    {
                        for (int i = 0; i < accommodation.Stars; i++)
                        {
                            @Html.Raw("★")
                        }
                        <span>(@accommodation.Stars)</span>
                    }
                    else
                    {
                        <span>N/A</span>
                    }
                </td>
                <td style="padding: 10px;">
                    @if (accommodation.HasPool)
                    {<span>Pool</span><br />}
                    @if (accommodation.HasSpa)
                    {<span>Spa</span><br />}
                    @if (accommodation.Accessible)
                    {<span>Accessible</span><br />}
                    @if (accommodation.HasWifi)
                    {<span>WiFi</span><br />}
                </td>
                <td style="padding: 10px; text-align: center;">
                    <strong>@accommodation.Units.Count</strong> units
                </td>
                <td style="padding: 10px;">
                    @(accommodation.IsDeleted ? "Deleted" : "Active")
                </td>
                <td style="padding: 10px;">
                    @Html.ActionLink("Edit", "EditAccommodation", new { id = accommodation.Id })

                    @if (!accommodation.IsDeleted)
                    {
                        @Html.Raw(" | ")
                        using (Html.BeginForm("DeleteAccommodation", "Manager", FormMethod.Post, new { style = "display:inline;" }))
                        {
                            <input type="hidden" name="id" value="@accommodation.Id" />
                            <input type="submit" value="Delete" onclick="return confirm('Are you sure you want to delete this accommodation?');"
                                   style="background-color: #ff4444; color: white; border: none; padding: 2px 8px;" />
                        }
                    }
                </td>
            </tr>
        }
    </table>
}
else
{
    <p>No accommodations yet. @Html.ActionLink("Add the first one", "CreateAccommodation", new { arrangementId = arrangement.Id })!</p>
}